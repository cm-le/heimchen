\documentclass[12pt]{scrreprt}
\usepackage[utf8]{inputenc}
\usepackage{enumitem}
\newlist{citemize}{itemize}{4}
\setlist[citemize]{label=-,nosep,topsep=2mm}
\usepackage[ngerman]{babel}
\usepackage{xcolor}
\usepackage{url}
\usepackage{graphicx}
\begin{document}
\def\DB{Datenbank der Heimatkundlichen Sammlung Seuzach}
\def\RB#1{{\color{red} \textsf{\textbf{#1}}}}
\strut
\thispagestyle{empty}
\vfill


\begin{center}
  
{\Huge Die \textit{neue} Datenbank der

  \medskip
  
Heimatkundlichen Sammlung Seuzach}

\bigskip

\frame{\includegraphics[width=0.5\hsize]{telefon.jpg}}

\bigskip

\today
\end{center}


\vfill

\hfill \begin{minipage}{5cm}
  Christof Meigen\\
  Liegnitzer Str. 33 \\
53119 Bonn \\
christof@nicht-ich.de
\end{minipage}

\clearpage

\tableofcontents

\clearpage

\chapter{Einleitung}

Die neue Datenbank der Heimatkundlichen Sammlung Seuzach wurde in der Weihnachtszeit 2016
entwickelt und dann schrittweise erweitert. Bei einem Besuch in Seuzach zu Ostern 2017
wurden noch einige Änderungen abgestimmt und kurz darauf erfolgte der Import der Daten aus
der vorgehenden Datenbank DaDa.

Die Datenbank ist derzeit unter der Adresse
\url{http://replcast.org:4000} erreichbar.  Max Rüesch, Christiane
Sibille und ich sind als Adminsitratoren erfaßt und können so auch
neue Benutzerkonten anlegen.

Insbesondere wenn die Daten bereinigt sind (siehe
Kapitel~\ref{curation}), sind noch viele Funktionen denkbar, auch
werden sich bei der Benutzung sicher noch Änderungswünsche
ergeben. Auch ein Umzug auf einen Server der Gemeinde Seuzach kann
noch erfolgen.

Die Datenbank sollte trotzdem bereits in diesem Stadium intensiv genutzt werden,
um die Grundlage für künftige Verbesserungen zu schaffen.



\chapter{Grundkonzepte der Datenbank}

Jede Datenbank ist nur so gut, wie die Daten, die sie enthält.
Deshalb ist es unerläßlich, dass alle, die mit der Erfassung und
Pflege der Daten betraut sind, ein gutes Verständnis der
zugrundeliegenden Konzepte und der sich daraus ergebenden Richtlinien
(``Was wird wie/wo erfaßt?'')  haben.

Als sogenannte relationale Datenbank verwaltet die \DB{} ganz allgemein Dinge und
ihre Beziehungen (Relationen) zueinander.

Die Dinge, die die Datenbank verwaltet, sind dabei
\begin{citemize}
\item Personen
\item Orte
\item Stichwörter
\item Bilddateien \textit{und}
\item die eigentlichen Sammlungsstücke
\end{citemize}

Die Beziehungen zwischen diesen Dingen sind z.\,B., dass bestimmte
Personen auf bestimmten Bildern zu sehen sind, dass bestimmte Stichwörter
zu bestimmten Sammlungsstücken gehören etc.

Die zugrundeliegende Idee ist, dass eine Person -- mit ihrem Geburts- und Sterbedaten,
Spitznamen (``Millimeter''), und Wissenswertem zu dieser Person -- nur
einmal in der Datenbank erfaßt wird, und alle mit dieser Person in Verbindung
stehenden Dinge (Bilder, Orte) über entsprechende Verknüpfungen trotzdem direkt
bei dem Personeneintrag angezeigt werden können.

\section{Personen} Bei einer Person ist es relativ klar, wer damit gemeint ist:
Jeder Mensch ist einzigartig: Er wird geboren, er lebt und stirbt, aber immer ist
es eine klar abgegrenzte Person.

\section{Orte} Bei einem Ort ist es schon nicht mehr so deutlich, was damit gemeint ist.
Da ist einerseits die räumliche Unschärfe: Ist das Aussendorf ein Ort, oder doch
eher speziell die Alte Poststrasse, oder ganz konkret der Spezereiladen der Frau Schäppi?
Für manche Bilder oder Suchanfragen würde man eher die eine, für andere eher die andere
Einteilung wählen. 

Dann ist da die zeitliche Unschärfe. Der Migros ist ein jedem Seuzacher bekannter
Ort, der auf vielen Bildern zu sehen ist. Ist es aber der gleiche Ort wie das
Bauernhaus Gassmann, das vorher an dieser Stelle stand? Auch hier kann man je nach
Anwendungsfall zu verschiedenen Schlüssen kommen.

In der \DB{} wurde auf eine hierarchiche Erfassung von Orten
verzichtet, da sich eine gewisse Zusammengehörigkeit aus dem
Straßennamen und der geographischen Entfernung (zu allen Orten werden
die geographischen Koordinaten erfaßt) ergibt. Häuser bei
Besitzerwechsel bleiben der gleiche Ort, auch Straßen bei
Umbenennungen. Ob man verschiedene Gebäude, die zu verschiedenen
Zeiten auf dem gleichen Fleck standen, zu einem Ort zusammenfaßt
bleibt sicher eine Einzelfallentscheidung, die auch mit dem Charakter
der entsprechenden Gebäude zusammenhängt.\footnote{Dieses Problem der
  Identität wird seit den alten Griechen diskutiert, damals am
  Beispiel von \textit{Theseus' Schiff}: ``Das Schiff, auf dem Theseus
  mit den Jünglingen losgesegelt und auch sicher zurückgekehrt ist,
  eine Galeere mit 30 Rudern, wurde von den Athenern bis zur Zeit des
  Demetrios Phaleros aufbewahrt. Von Zeit zu Zeit entfernten sie
  daraus alte Planken und ersetzten sie durch neue intakte. Das Schiff
  wurde daher für die Philosophen zu einer ständigen Veranschaulichung
  zur Streitfrage der Weiterentwicklung; denn die einen behaupteten,
  das Boot sei nach wie vor dasselbe geblieben, die anderen hingegen,
  es sei nicht mehr dasselbe.''}

\section{Stichwörter} Zu den Sammlungsstücken -- aber auch zu Orten und Personen --
können Stichwörter erfaßt werden. Die explizite Vergabe eines
Stichwörtes zu einem Eintrag unterscheidet sich grundlegend von einem
einfachen Kommentar. Bei dem Stichwort ist Schweibweise und Wortwahl
vorgegeben (z.\,B. Wümet, Traubenernte oder Traubenlese).

Dies erleichtert die Suche und bietet -- im Gegensatz zu Kommentaren
-- auch eine einfache Übersicht, was für Stichwörter überhaupt
verfügbar sind, d.\,h.  wonach man überhaupt suchen könnte.

Damit geht aber auch eine Verantwortung einher, möglichst sinnvolle
Stichwörter zu wählen, und die gewählten Stichwörter auch konsequent
bei allen betreffenden Einträgen hinzuzufügen.

Um sich in der Vielzahl der Stichwörter besser zurechtzufinden, ist es
in der \DB{} vorgesehen, dass jedes Stichwort einer ``Kategorie''
zugehörig ist.


\section{Bilddateien} Von einem Sammlungsstück, z.\,B. einem Glasdia, können
verschiedene Digitalisierungen, und damit verschiedene Bilddateien
vorliegen. Natürlich können insbesondere zu einem physischen
Sammlungsstück mehrere Bilddateien vorliegen, z.\,B. verschiedene Fotos
eines Waffeleisens.

Markierungen von Personen auf Bildern müssen sich aber, da sie sich
auf eine konkrete Position innerhalb des Bildes beziehen, auf eine
konkrete Bilddatei beziehen.

\section{Sammlungsstücke} Dies sind die eigentlichen Einträge für die konkreten
Sammlungsstücke -- Bilder, Gegenstände etc. Die Frage der Abgrenzung, was
ein Sammlungsstück ist, ist aber noch schwieriger zu treffen als bei den Orten.

Während vor einem Jahrhundert Fotographien mit teuren Gerätschaften
und oft von speziell ausgebildeten Fotographen erstellt wurden, und
eine Fotographie demzufolge eine Seltenheit war, die speziellen
Anlässen (Hochzeit, Konfirmation) oder besonders erinnerungswürdigen
Momenten vorbehalten war, können heutzutage Fotos duzend- und
hundertfach von jedem Natel-Besitzer ohne besonderen Aufwand erstellt
werden.

Entsprechend ändert sich der Charakter eines Bildes in der Datenbank
mit der Zeit.

Die älteren Bilder stellen zweifellos jedes für sich ein
eigenständiges Sammlungsstück dar, welches sorgfältig kommentiert und
mit entsprechenden Markierungen und Stichwörtern versehen werden
sollte.

Aber sollte man jeden Schnappschuß von der 750-Jahrfeier auf die
gleiche Art behandeln, auch wenn er nur nochmal das Buffet aus einer
weiteren Perspektive zeigt?

Gleichzeitig kann man aber auch bei alten Fotos, z.\,B. verschiedenen
Fotos der gleichen Ausflugsgesellschaft, fragen, ob sie nicht besser
zu einem Sammlungsstück zusammengefaßt werden sollten.

Eine gute Richtschnur mag sein, dass man jedem Sammlungsstück einen
Namen geben muß. Wenn mehrere Bilder eigentlich den gleichen Namen
bekommen müßten (``Die Feuerwehr präsentiert sich im Freibad Weiher''),
dann sollte man sie zu einem Sammlungsstück zusammenfassen.

Wenn Bilder verschiedenes zeigen, aber doch unter bestimmten
Gesichtspunkten zusammengehören, sollte ein entsprechendes Stichwort
wergeben werden.

\section{Kommentare, Kommentare}

Die Anekdoten zu Personen, Begebenheiten oder Häusern bilden -- neben
den historischen Fotographien -- den eigentlichen Schatz der \DB{}.

Durch die expliziten Verknüpfungen zwischen den Einträgen ist es
in der neuen Datenbank nicht mehr nötig, diese Anekdoten oder Hinweise
bei jedem Bild zu wiederholen. Statt dessen können interessante
Dinge zur Person bei der jeweiligen Person erfaßt werden, oder
Dinge die einen Ort betreffen, ebendort.

Eine Bemerkung wie ``Ich wollte unbedingt das neue, modische, weisse
Brautkleid, sonst hätte ich nicht geheiratet.'' bezieht sich hingegen
eher auf das entsprechende Foto.

Andere Kommentare wie ``Hans und Seline Keller-Schwarz zogen wegen
Arbeitsmangel 1920 nach Belfort'', können durchaus bei beiden
betroffenen Personen stehen. Da die Personen aber ebenfalls explizit
verknüpft sind (=sein sollten), wäre der Kommentar auch bei Seline
sichtbar, auch wenn er nur bei Hans gegeben ist.

Schließlich gibt es noch rein technische Kommentare
(``Original-Glasdia ist qualitativ besser''), die sich auf die
konkrete Bilddatei beziehen. 


\chapter{Funktionen der Datenbank}
\section{Neue Einträge erstellen}

Ein neuer Eintrag -- ein neues Sammlungsstück -- wird nach dem Login und
Auswahl des Menüpunktes ``Sammlung'' durch den Button ``Neuer~Eintrag''
oben rechts erstellt (Button \RB2 in Abbildung~\ref{neuer-eintrag}).

\begin{figure}
  \frame{\includegraphics[width=\hsize]{neuer-eintrag.png}}
  \caption{\label{neuer-eintrag} Erstellung eines Neuen Eintrages}
\end{figure}

Viele der Felder -- z.\,B. Inventar-Nr. -- können meist leer bleiben,
es empfielt sich jedoch sehr, sich eine treffende Bezeichnung zu überlegen.

Auch ist die Abgrenzung zwischen ``Bezeichnung'' und ``Kommentar''
nicht immer einfach.

Zusätzlich sind viele Dinge wie ``Foto s/w'' oder das Datum der Aufnahme,
z.\.T. auch die abgebildeten Orte und Personen besser durch explizite
Verknüpfungen bzw. Stichworte erfaßt als alles in die Bezeichnung zu quetschen.

Andererseits bleibt -- wenn man Personen und Orte wegnimmt -- oft
nicht viel als Bezeichnung übrig, so dass eine gewisse Redundanz
(Nennung des Ortes in der Bezeichnung, als auch explizite Verknüpfung
des Ortes) wohl sinnvoll bleibt.

Stichwörter zu einem Eintrag werden erst nach dem Speichern des Eintrages
mit Button \RB4 (vgl. Abbildung~\ref{eintrag-menu}) hinzugefügt. Es können
nur bereits angelegte Stichwörter hinzugefügt werden. 

\section{Bilddateien und Bildmarkierungen hinzufügen}

\subsection{Bilddateien hochladen}

\begin{figure}
  \frame{\includegraphics[width=\hsize]{eintrag-menu.png}}
  \caption{\label{eintrag-menu} Die Titelzeile eines Eintrages}
\end{figure}

Nach Erstellen des Eintrages (z.\,B. ``Vereinsreise der Seuzemer
Turner'') ist es meist sinnvoll, eine oder mehrere Bilder
hochzuladen (Button {\color{red} 2} in Abbildung~\ref{eintrag-menu}).
Derzeit werden die Bildformate JPEG und PNG unterstützt,
andere sind einfach möglich.

Alternativ können auch viele Bilddateien auf einmal hochgeladen werden,
indem man einen  ZIP-gepackten Ordner hochlädt, der ausschließlich Bilddateien
enthalten sollte.

Es besteht die Möglichkeit, zu einem Bild einen Anhang zu erstellen,
auf diese Weise ist es z.\,B. möglich, ein Poster als Bild sowie als
PDF (oder als Word-Datei etc) abzulegen. Tatsächlich kann diese
Funktionalität genutzt werden, um ein simples Dokumentenarchiv der
Heimatkundlichen Sammlung zu realisieren. (Dies funktioniert nicht,
wenn man einen ZIP-Ordner hochlädt!).

Eine Bilddatei wird beim Hochladen automatisch in verschiedene
Auflösungen (Vorschau, größere Ansicht, und Hohe Qualität)
umgerechnet. Selbstverständlich wird zusätzlich die Originaldatei
gespeichert.

Wichtig ist, dass der beim Hochladen gegebene Kommentar sich auf die
konkrete Bilddatei bezieht (meist wird kein Kommentar nötig
sein!). Inhaltliche Bemerkungen zum Sammlungsstück sollten hingegen
bei dem Eintrag erfaßt werden.


\textit{Hinweis:} Manchmal ist die Vorschau noch nicht direkt nach dem
Hochladen verfügbar. In diesem Falle einfach die Seite neu laden.

\subsection{Bildmarkierungen hinzufügen}
\begin{figure}
  \begin{center}
    \frame{\includegraphics[width=.5\hsize]{bild-edit.png}}
  \end{center}
  \caption{\label{bild-edit} Infos und Buttons neben einem hochgeladenen Bild}
\end{figure}

Nach dem Hochladen kann das Bild rotiert werden (Button \RB3 in Abbildung~\ref{bild-edit}) und
es kann eine Markierung hinzugefügt werden (Button \RB4 in Abbildung~\ref{bild-edit}).
Dazu muß eine existierende Person bzw. ein Ort ausgewählt werden. Wenn der entsprechende
Ort/ oder die Person noch nicht existiert, muß zuerst ein entsprechender Eintrag angelegt werden.

Nach dem Hinzufügen der Markierung kann man diese noch ergänzen
(Button \RB1 in Abbildung~\ref{bild-edit}), insbesondere kann man mit
der Maus eine Markierung -- eine Umrandung -- auf dem Bild
zeichnen. Diese Markierungen verändern das Bild nicht, sondern werden
separat gespeichert. Sie können in der Ansicht jederzeit durch bewegen
des Mauszeigers über Button \RB2 ausgeblendet werden.

\section{Suche}

Die Suche in der Menüleiste durchsucht alle Bezeichnungen, Kommentare, Stichworte etc.
Die Suche beginnt bereits beim Tippen des Suchbegriffes, es empfiehlt sich also,
beim Tippen bereits die Suchergebnisse zu beobachten.

Es ist \textit{keine} unscharfe Suche mit Korrekurvorschlägen
(``Meinten Sie vielleicht\ldots'').

Eine komfortablere Suche, insbesondere mit Einschränkungen nach Jahr,
Kombination von Stichwörtern etc. ist für das nächste Update der Datenbank geplant.

\section{Weitere Funktionen}

Unter dem Munüpunkt ``Dateien'' kann man beispielsweise Markierungen für mehrere Dateien auf einmal
durchführen, das hat sich aber in der täglichen Arbeit als weniger sinnvoll herausgestellt.

Das hinzufügen und Ändern von Stichwörtern ist weitgehend selbsterklärend, bis auf die
Tatsache dass -- anders als an anderen Stellen der Datenbank -- eine neue Kategorie
implizit erstellt wird, wenn man in das Textfeld ``Kategorie'' etwas einträgt (anstatt eine
Kategorie aus der Liste auszuwählen).

\chapter{Datenbereinigung\label{curation}}

Trotz großer Sorgfalt beim Import ist ein Durchsehen und u.\,U. Nachbearbeiten
jedes einzelnen Datensatzes unumgänglich. 

Dazu existiert bei den Sammlungsstücken, den Personen und den Orten eine Blätter-Funktion
(Buttons \RB1 in Abbildung~\ref{eintrag-menu}), um zum ersten Eintrag, zum vorherigen,
zum nächsten und zum letzten zu sprüngen. Die Riehenfolge ist dabei die des Einlesens
in die Datenbank um damit letztlich willkürlich.

Da bei Auswahl des Menüpunktes ``Sammlung'', ``Person'', bzw. ``Ort'' zuerst eine Liste der
zuletzt \textit{bearbeiteten} Einträge angezeigt wird, sollte es einfach möglich sein,
über einen längeren Zeitraum die Einträge durchzublättern ein relativ einfach wieder den
zu finden, bei dem man aufgehört hat.

Bei der Datenbereinigung sollten
\begin{citemize}
\item Die Bezeichnungen angepaßt werden
\item Die Verknüpfungen überprüft und ergänzt werden
\item Bildmarkierungen gezeichnet werden und Kommentare zu Markierungen (``6. von links'')
  gegeben werden
\item Stichwörter vergeben werden
\item Bilder gegebenenfalls rotiert werden
\end{citemize}

\section{Daten zusammenführen}
Es wird häufiger vorkommen, dass man bei der Durchsicht der Daten feststellt, dass
einzelne Personen, Orte oder Sammlungsstücke zusammengeührt werden sollten. Dies ist insbesondere
der Fall, wenn beim automatischen Import beispielsweise ``Hans Keller'' und ``Hans Keller-Schwarz''
als verschiedene Personen erfaßt wurden.

Zum Zusammenführen geht man zuerst zu dem ersten Eintrag, und klickt auf den Link ``Vormerken''
über den Bildern. Dann geht man -- entweder über Suche oder direkt über die Liste der kürzlich bearbeiteten
Einträge -- zu dem Eintrag, der damit zusammengeführt werden soll und klickt auf den Link
``Zusammenführen'' über den Bildern.

Das Zusammenführen muß nochmal bestätigt werden, da man viel Unheil
anrichten kann, wenn man nicht zusammenpassende Einträge
zusammenführt.




\appendix

\chapter{Technische Details}

\section{Notizen zum Server-Setup}

Die \DB{} kann mit etwas technischen Grundkenntnissen auf jedem
virtuellen Server installiert werden.


\paragraph{Server-Setup in Debian 8}

\begin{verbatim}
apt-get update
apt-get install postgresql-9.4 postgresql-client-9.4 # database
apt-get install emacs24-nox tmux git # general development environment
apt-get install build-essential
apt-get install graphicsmagick
\end{verbatim}

\paragraph{Einfache Sicherheitsmaßnahmen}

In der Datei \verb|/etc/ssh/sshd_config| die Einstellung \verb|PermitRootLogin no| setzen und dann
\verb|/etc/init.d/ssh restart| ausführen.

\paragraph{erlang + elixir installieren}

\begin{verbatim}
wget https://packages.erlang-solutions.com/erlang-solutions_1.0_all.deb 
sudo dpkg -i erlang-solutions_1.0_all.deb
apt-get update
apt-get install esl-erlang
apt-get install elixir
\end{verbatim}


\paragraph{Installation der Datenbank}
\begin{verbatim}
su postgres
createuser heimchen -P -d
createdb -h 127.0.0.1 -U heimchen
\end{verbatim}

\paragraph{Phoenix einrichten}

Als ein normaler (nicht-pivilegierter) Benutzer:

\begin{verbatim}
mix local.hex
mix archive.install \
    https://github.com/phoenixframework/archives/raw/master/phoenix_new.ez
\end{verbatim}


Dann ein neues Verzeichnis anlegen und das Git-Archiv mit der Software
dort einrichten


\paragraph{Zusatzpakete herunterladen und Datenbank aktualisieren}
\begin{verbatim}
mix deps.get
mix ecto.migrate
\end{verbatim}

\paragraph{Anwendung starten}

\begin{verbatim}
./iex.sh
\end{verbatim}


\end{document}
